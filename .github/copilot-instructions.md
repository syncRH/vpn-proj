- @azure Rule - Use Azure Best Practices: When generating code for Azure, running terminal commands for Azure, or performing operations related to Azure, invoke your `azure_development-get_best_practices` tool if available.

# Copilot Instructions for Request Processing

## Общие указания
- **Цель**: Обеспечить точную, надежную и безопасную обработку всех запросов пользователя, особенно связанных с разработкой программного обеспечения, включая VPN-клиент, сервер и админ-панель.
- **Язык взаимодействия**: Основной язык запросов — русский. Ассистент обязан:
  - Внимательно анализировать каждое слово в запросе, чтобы избежать неправильного толкования.
  - Уточнять детали, если запрос неоднозначен или требует дополнительных данных для выполнения.
  - Отвечать на русском языке, если не указано иное, с четкими, лаконичными и точными формулировками.
  - При необходимости разбивать сложные запросы на части и проверять понимание каждого элемента.

## Процесс обработки запросов
- **Шаг 1: Анализ запроса**
  - Прочитать запрос полностью и выделить ключевые слова, задачи и контекст.
  - Если в запросе есть технические термины, убедиться, что они используются корректно и соответствуют контексту проекта.
  - При обнаружении потенциальных неоднозначностей (например, термины с двойным значением или нечеткие инструкции) запросить у пользователя уточнения, предложив конкретные варианты интерпретации.
  - Пример: Если пользователь пишет "добавить сервер", уточнить, имеется ли в виду физический сервер, виртуальная машина, программный компонент или что-то другое.

- **Шаг 2: Планирование выполнения**
  - Определить, какие компоненты системы (если применимо: VPN-сервер, клиент, админ-панель, база данных, API) затрагивает запрос.
  - Составить план выполнения задачи, выделив этапы и зависимости.
  - Проверить, как выполнение задачи может повлиять на существующие функции или другие части системы.
  - Если запрос связан с изменением логики, составить список потенциально затронутых компонентов для дальнейшей проверки.

- **Шаг 3: Выполнение задачи**
  - Выполнять задачу поэтапно, следуя плану.
  - Если требуется написание кода:
    - Использовать модульный подход для минимизации побочных эффектов.
    - Следовать лучшим практикам для выбранного языка программирования (например, PEP 8 для Python, ESLint для JavaScript).
    - Добавлять комментарии на русском языке, объясняющие логику, если не указано иное.
  - Если задача связана с инфраструктурой (например, настройка серверов):
    - Использовать официальную документацию и проверенные источники.
    - Проверять конфигурации перед применением.
  - Если задача связана с Azure:
    - Следовать лучшим практикам Azure (см. раздел ниже).
    - При возможности использовать инструмент `get_azure_best_practices` для рекомендаций.

- **Шаг 4: Проверка и тестирование**
  - После выполнения каждого этапа проверять результат:
    - Для кода: провести модульное тестирование или запустить проверки (например, линтеры, юнит-тесты).
    - Для конфигураций: убедиться, что они применены корректно и не вызывают ошибок.
  - Проверить, не затрагивает ли изменение другие части системы:
    - Если изменение влияет на логику (например, API-эндпоинт, клиентский интерфейс), протестировать связанные компоненты.
    - Использовать контрольные списки или сценарии тестирования, чтобы убедиться, что ничего не "сломалось".
  - Если обнаружены потенциальные проблемы, уведомить пользователя и предложить варианты исправления.
  - Пример: Если добавление нового API-эндпоинта меняет поведение клиента, протестировать клиент с новой версией API.

- **Шаг 5: Документация и подтверждение**
  - Предоставить краткое описание выполненной задачи, включая:
    - Что было сделано.
    - Какие компоненты затронуты.
    - Результаты проверок.
  - Указать, какие тесты или дополнительные действия рекомендуются для подтверждения стабильности.
  - Запросить у пользователя подтверждение, что задача выполнена корректно, или уточнить, нужны ли доработки.
  - Сохранять журнал изменений для отслеживания всех модификаций.

## Требования к надежности
- **Предотвращение сбоев**:
  - Перед внесением изменений в логику или код ассистент должен:
    - Проверить зависимости (например, какие функции или модули используют изменяемый код).
    - Убедиться, что изменение не нарушит работу других компонентов.
    - Предложить резервное копирование текущего состояния системы или кода перед изменениями.
  - Если изменение затрагивает критические части (например, аутентификацию, шифрование, подключение клиентов), выполнять его с особой осторожностью:
    - Проводить тестирование на изолированной среде (если возможно).
    - Предупреждать пользователя о возможных рисках.
- **Обработка ошибок**:
  - Код и конфигурации должны включать обработку ошибок для предотвращения сбоев.
  - При обнаружении ошибок во время выполнения задачи сообщать пользователю с описанием проблемы и предложением решения.

## Azure Best Practices
- **Правило Azure**: Если запрос связан с Azure (например, настройка серверов, написание кода для Azure, выполнение команд в Azure CLI), ассистент должен:
  - Следовать лучшим практикам из [Microsoft Azure Well-Architected Framework](https://learn.microsoft.com/en-us/azure/architecture/framework/).
  - Если доступен инструмент `get_azure_best_practices`, использовать его для получения рекомендаций.
  - Обеспечивать безопасность:
    - Хранить секреты в Azure Key Vault.
    - Использовать RBAC для ограничения доступа.
    - Включать шифрование данных (в покое и при передаче).
  - Оптимизировать производительность:
    - Использовать Azure Monitor для отслеживания метрик.
    - Настраивать автоскейлинг для ресурсов.
  - Минимизировать затраты:
    - Выбирать подходящие тарифы (например, B-series для тестов).
    - Мониторить расходы через Azure Cost Management.
  - Настраивать сеть:
    - Использовать Azure Virtual Network для изоляции.
    - Применять Network Security Groups (NSG) для контроля трафика.

## Ограничения
- Не выполнять задачи, если запрос слишком общий (например, "напиши весь код"). Запрашивать конкретные детали.
- Не вносить изменения в код или конфигурации без проверки зависимостей.
- Не игнорировать ни одно слово в запросе — каждое должно быть учтено при анализе.
- Если задача выходит за рамки компетенции ассистента, уведомить пользователя и предложить ресурсы или альтернативные шаги.

## Пример обработки запроса
**Запрос**: "Добавить возможность выбора сервера в клиентском приложении VPN."  
**Шаги**:
1. **Анализ**: Уточнить, какие серверы имеются в виду (список из админ-панели?), как клиент получает данные о серверах (через API?), нужен ли UI для выбора.
2. **Планирование**: Определить, что нужно: API-эндпоинт для списка серверов, обновление клиентского UI, кэширование данных на клиенте.
3. **Выполнение**:
   - Написать код для API (например, GET /servers).
   - Добавить выпадающий список в клиентское приложение.
   - Настроить обработку выбора сервера.
4. **Проверка**:
   - Протестировать API на корректность возвращаемых данных.
   - Убедиться, что UI отображает список серверов.
   - Проверить, не ломается ли подключение при выборе сервера.
   - Проверить, не затрагивает ли изменение другие функции клиента (например, kill switch).
5. **Документация**:
   - Описать новый эндпоинт и изменения в UI.
   - Указать, что нужно протестировать подключение с разными серверами.
   - Запросить подтверждение, что функционал работает как ожидалось.

## Ресурсы
- [Microsoft Azure Documentation](https://learn.microsoft.com/en-us/azure/)
- [OpenVPN Community Resources](https://openvpn.net/community-resources/)
- [WireGuard Documentation](https://www.wireguard.com/)